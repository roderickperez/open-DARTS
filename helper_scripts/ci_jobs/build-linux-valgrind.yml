include:
  - local: 'helper_scripts/ci_jobs/build-linux-base.yml'

build-linux-3.10-valgrind:
    stage: build
    tags:
        - linux
    rules:
        - if: $CI_COMMIT_REF_PROTECTED == "true"
        - if: $CI_PIPELINE_SOURCE == "merge_request_event"
        - if: $CI_COMMIT_BRANCH == "main" || $CI_COMMIT_TAG =~ /^v?[0-9]+\.[0-9]+\.[0-9]+/
        - if: $TEST_CUSTOM_BRANCH == "1"
        - if: $TEST_ALL_PYTHONS == "1"   
    extends: .build-linux-dockcross
    variables:
        PY_VER: '3.10'
        PY_SUF: 'cp310-cp310'
        ODLS: '-a'
    script:
        - echo ">>> Starting debug build (valgrind instrumentation) <<<"
        - ./helper_scripts/build_darts_cmake.sh -c -w -m -j 8 -v $ODLS -p
    artifacts:
      paths:
        - './dist/*.whl'
        - '*.log'
      expire_in: 1 week
      when: always 